---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import {
  imageUrl,
  srcset,
  DETAIL_WIDTHS,
  DETAIL_SIZES,
} from "../../lib/images";

export async function getStaticPaths() {
  const items = await getCollection("portfolio");
  return items.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { data } = entry;
const { Content } = await entry.render();

const defaultDetail = 1200;
---

<BaseLayout title={data.title}>
  <article class="box">
    <h1 style="margin-top:0;">{data.title}</h1>
    {
      (data.location || data.date) && (
        <p class="small">
          {data.location ? data.location : ""}
          {data.location && data.date ? " â€¢ " : ""}
          {data.date ? data.date : ""}
        </p>
      )
    }

    <hr class="hr" />

    <img
      src={imageUrl(data.imageSlug, defaultDetail)}
      srcset={srcset(data.imageSlug, DETAIL_WIDTHS)}
      sizes={DETAIL_SIZES}
      alt={data.coverAlt}
      loading="eager"
      decoding="async"
      style="border:1px solid var(--rule); border-radius: var(--radius); width:100%; height:auto;"
    />

    <div style="max-width: 72ch; margin-top: 14px;">
      <Content />
    </div>
  </article>
</BaseLayout>
